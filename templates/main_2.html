
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>크래프톤 정글 7팀</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="/static/skydash/vendors/feather/feather.css">
    <link rel="stylesheet" href="/static/skydash/vendors/feather/feather.css">
    <link rel="stylesheet" href="/static/skydash/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="/static/skydash/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="/static/skydash/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="/static/skydash/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" type="text/css" href="/static/skydash/js/select.dataTables.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="/static/skydash/css/vertical-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="/static/skydash/images/favicon.png" />

    <!-- 스와핑 -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/css/swiper.min.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/css/swiper.css'>
    <link rel="stylesheet" href="/static/swapping/css/swapping.css">
</head>
<body>
<div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">

        <div class="navbar-menu-wrapper col-lg-12 col-12 d-flex align-items-center justify-content-end">
            <span style="margin-right: 15px;">사용자 명</span>
            <button class="btn btn-primary">로그아웃</button>
            <!--        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">-->
            <!--          <span class="icon-menu"></span>-->
            <!--        </button>-->
        </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
        <!-- partial:partials/_settings-panel.html -->

        <div class="main-panel">
            <div class="content-wrapper">
                <div class="row">
                    <div class="col grid-margin">
                        <div class="row">
                            <div class="col col-xl-8 mb-4 mb-xl-0" style="display: flex; justify-content: center;">
                                <h3 class="font-weight-bold">기간별 포스팅 랭킹</h3>
                            </div>
                            <div class="col col-xl-4">
                                <div class="justify-content-end d-flex">
                                    <div style="display: flex;">
                                        <label style="width: 90px; display: flex; align-items: center; justify-content: center; margin: 0px;">작성월</label>
                                        <input type="month" class="form-control" id="SearchWriteMonth" onchange="ChangeSearchMonth($('#SearchWriteMonth').val());">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 grid-margin stretch-card" >
                        <div class="card tale-bg" >
                            <div class="card-people mt-auto">
                                <div class="wrapper">

                                    <section class="module-team">

                                        <div class="team">
                                            <div class="team-cards">

                                                <!-- Slider main container -->
                                                <div class="swiper-container" style="padding: 0px; margin: 0px;">
                                                    <!-- Additional required wrapper -->
                                                    <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(0px, 0px, 0px);;"></div>

                                                </div>

                                                <div class="swiper-pagination"></div>
                                                <!-- If we need navigation buttons -->
                                                <div class="navigation" style="top: 155px;">
                                                    <div class="swiper-button-prev"></div>
                                                    <div class="swiper-button-next"></div>
                                                </div>
                                            </div>

                                        </div>

                                    </section>
                                </div>

                            </div>
                        </div>
                    </div>

                </div>


                <!--          이날의 포스팅-->
                <div class="row">
                    <div class="col-md-12 grid-margin">
                        <div class="row">
                            <div class="col-12 col-xl-8 mb-4 mb-xl-0" style="display: flex; justify-content: center;">
                                <h3 class="font-weight-bold">이날의 포스팅</h3>
                            </div>
                            <div class="col-12 col-xl-4">
                                <div class="justify-content-end d-flex">
                                    <div style="display: flex;">
                                        <label style="width: 90px; display: flex; align-items: center; justify-content: center; margin: 0px;">작성일</label>
                                        <input type="date" class="form-control" id="InputSearchDate" onchange="ChangeSearchDate($('#InputSearchDate').val(),$('#SelectSearchUser').val())">
                                    </div>
                                    <div style="display: flex; margin-left: 15px;">
                                        <label style="width: 90px; display: flex; align-items: center; justify-content: center; margin: 0px;">작성자</label>
                                        <select id="SelectSearchUser" class="form-control" onchange="ChangeSearchDate($('#InputSearchDate').val(),$('#SelectSearchUser').val())">
                                            <option>모두</option>
                                            {% for user in user_list %}
                                            <option>{{ user.user_id }}</option>
                                            {% endfor %}
                                        </select>


                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title">게시물 목록</h4>
                            <!--                            <p class="card-description">-->
                            <!--                                검색결과 표출?-->
                            <!--                            </p>-->
                            <div class="table-responsive">
                                <table id="PostTable" class="table table-hover">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <!-- content-wrapper ends -->
            <!-- partial:partials/_footer.html -->
            <footer class="footer">
                <div class="d-sm-flex justify-content-center justify-content-sm-between">
                    <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">크래프톤 정글 7조</span>
                </div>
                <!--                <div class="d-sm-flex justify-content-center justify-content-sm-between">-->
                <!--                    <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Distributed by <a href="https://www.themewagon.com/" target="_blank">Themewagon</a></span>-->
                <!--                </div>-->
            </footer>
            <!-- partial -->
        </div>
        <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>
<!-- container-scroller -->

<!-- plugins:js -->
<script src="/static/skydash/vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page -->
<script src="/static/skydash/vendors/chart.js/Chart.min.js"></script>
<script src="/static/skydash/vendors/datatables.net/jquery.dataTables.js"></script>
<script src="/static/skydash/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
<script src="/static/skydash/js/dataTables.select.min.js"></script>

<!-- End plugin js for this page -->
<!-- inject:js -->
<script src="/static/skydash/js/off-canvas.js"></script>
<script src="/static/skydash/js/hoverable-collapse.js"></script>
<script src="/static/skydash/js/template.js"></script>
<script src="/static/skydash/js/settings.js"></script>
<script src="/static/skydash/js/todolist.js"></script>
<!-- endinject -->
<!-- Custom js for this page-->
<script src="/static/skydash/js/dashboard.js"></script>
<script src="/static/skydash/js/Chart.roundedBarCharts.js"></script>
<!-- End custom js for this page-->

<!--  스와핑-->

<!-- <script src='/static/swapping/js/swapping.js'></script> -->

<script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/js/swiper.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.0/js/swiper.min.js'></script>

<script>
    ////////스와핑
    var team;
    var swiperWrapper = document.querySelector('.swiper-wrapper');
    // var swiperWrapper = $('.swiper-wrapper');

    var iWebsite = "https://rafaelalucas.com/dailyui/6/assets/link.svg";
    ///////스와핑

    let today = new Date();
    console.log('today='+today);
    let year = today.getFullYear(); // 년도
    let month = today.getMonth() + 1;  // 월
    let day = ('0' + today.getDate()).slice(-2);

    let TodayDate = (year + '-' + month + '-' + day);
    let TodayMonth = (year + '-' + month);

    let SearchDate = TodayDate;
    let SearchUser = '모두';

    let SearchYearNMonth = TodayMonth;

    //기본값 오늘로 설정
    $('#InputSearchDate').val(TodayDate);
    $('#SearchWriteMonth').val(TodayMonth);

    $(document).ready(function () {
        //검색 요일(작성일)에 맞는 리스트 가져옴
        show_list(SearchDate, SearchUser);

        //사용자 읽어오기
        // show_user_list();
        show_rank(SearchYearNMonth);


    });


    function fighting_modal(post_url){
        $("#fightingModal").modal('show');
    }

    function submitSupport() {
        let message = $("#supportMessage").val();

        if (!message) {
            alert("메시지를 입력해주세요!");
            return;
        }

        $.ajax({
            type: "POST",
            url: "/api/fight",
            data: {'message': message, 'post_url':SearchUser , 'user' : 'test1' },
            success: function(response) {
                
            },
        })
        // 여기에 응원 메시지를 처리하는 로직을 추가할 수 있습니다.
        console.log("응원 메시지:", message);

        // 모달 닫기
        $("#fightingModal").modal('hide');
    }
    

    function append_html(ID,text){ //붙여넣을 테이블 또는 select id
        $("#"+ID).empty();
        $("#"+ID).append(text);
    }

    function make_table(Data){

        var text=`<thead><tr><th>post_title</th><th>post_url</th><th>user_id</th><th>post_date</th> <th>응원하기</th> <th>응원펼치기</th>  </tr></thead>`;
        if(Data[0]=='undefined' | Data.length==0){
            text+="<tbody>데이터 없음</tbody>";
        }else{
            text+=`<tbody>`;
            for(var i=0;i<Data.length;i++){
                text+=`<tr>`;
                text+=`<td>${Data[i]['post_title']}</td>`;
                text+=`<td>${Data[i]['post_url']}</td>`;
                text+=`<td>${Data[i]['user_id']}</td>`;
                text+=`<td>${Data[i]['post_date']}</td>`;
                text+=`<td> <button onclick=" fighting_modal('${Data[i]['post_url']}')" >응원하기</button> </td>`;
                text+=`<td> <button >펼치기</button> </td>`;
                text+=`</tr>`;
            }
            text+=`</tbody>`;
        }
        // console.log("text="+text);
        return text;

    }
    function make_select(Data){
        var text=`<option selected>모두</option>`;
        for(var i=0;i<Data.length;i++){
            //{'_id': ObjectId('6526848b47ac657cae9f14a9'), 'user_id': 'test2',
            // 'user_password': 'password1', 'user_gender': 'M',
            // 'user_birth': '1990-01-01', 'user_url': 'https://study4silver.tistory.com/',
            // 'user_lastpost': '', 'user_name': '전상하'}
            text+=`<option>${Data[i]['user_id']}</option>`;

        }
        return text;
    }


    function show_list(SearchDate, SearchUser){
        $.ajax({
            type: "GET",
            url: "/api/list",
            data: {'searchdate': SearchDate, 'searchuser':SearchUser},
            success: function(response) {
                if (response['result'] != 'success') {
                    alert(SearchDate + ' 검색 실패!')
                    return
                }

                let posts = response['post_list']
                //{_id: '6526848b47ac657cae9f14ac',
                // post_title: '[Python] @dataclass로 파이썬 클래스 마스터하기',
                // post_url: 'https://datasciencebeehive.tistory.com/4',
                // user_id: 'test2', post_date: '2023-10-12'}

                let text = make_table(posts);
                // console.log('text='+text);
                append_html("PostTable",text);
            },
        })
    }


    function show_rank(InputYearNMonth){
        $.ajax({
            type: "GET",
            url: "/api/list/rank",
            data: {'searchyearnmonth': InputYearNMonth},
            success: function(response) {
                if (response['result'] != 'success') {
                    alert(SearchYearNMonth + ' 랭크 검색 실패!')
                    return
                }

                let posts = response['post_rank'];
                team = input_team_data(posts);
                addTeam(team);

                var mySwiper = new Swiper(".swiper-container", {
                    // Optional parameters
                    direction: "horizontal",
                    loop: false,
                    centeredSlides: false,
                    speed: 800,
                    slidesPerView: 3,
                    spaceBetween: 40,
                    threshold: 5,


                    // If we need pagination
                    pagination: {
                        el: ".swiper-pagination",
                        clickable: true
                    },

                    // Navigation arrows
                    navigation: {
                        nextEl: ".swiper-button-next",
                        prevEl: ".swiper-button-prev"
                    },
                    breakpoints: {
                        1180: {
                            slidesPerView: 2,
                            spaceBetween: 40,
                            centeredSlides: false,
                        },
                        799: {
                            slidesPerView: 1,
                            spaceBetween: 20,
                            centeredSlides: true,
                            loop: true,
                        },
                    }
                });

                /* Show More */

                var btnShow = document.querySelectorAll('.more');



                btnShow.forEach(function (el) {
                    el.addEventListener('click', showMore);
                });

                function showMore(event) {
                    var card = event.target.closest(".swiper-slide");

                    if (card.classList.contains('show-more')) {
                        card.classList.remove('show-more');
                    } else {
                        card.classList.add('show-more')
                    }

                }

            },
        })
    }



    function input_team_data(Data){
        if (Data.length ==0){
            console.log("랭크 데이터 없음!");
        }else{
            var arr=[]
            for(var i=0;i<Data.length;i++){
                //[{'user_name': '박정민', 'user_id': 'test1', 'post_cnt': 4, 'user_url': 'https://park-dev-diary.tistory.com/', 'rank': 1},
                // {'user_name': '전상하', 'user_id': 'test2', 'post_cnt': 3, 'user_url': 'https://study4silver.tistory.com/', 'rank': 2},
                // {'user_name': '조현지', 'user_id': 'test3', 'post_cnt': 1, 'user_url': 'https://dev-dobim.tistory.com/', 'rank': 3}]
                arr.push({rank:Data[i]['rank'],name:Data[i]['user_name'],id:Data[i]['user_id'],post_cnt:Data[i]['post_cnt'],photo:"/static/img/default.jpg",website:Data[i]['user_url'],})
            }
            console.log('arr==='+JSON.stringify(arr));
        }
        return arr
    }


    function ChangeSearchDate(InputSearchDate,SelectSearchUser) {
        if (SearchDate == InputSearchDate && SearchUser == SelectSearchUser) {
            return
        }

        SearchDate = InputSearchDate;
        SearchUser = SelectSearchUser;
        show_list(SearchDate, SearchUser);
    }

    function ChangeSearchMonth(InputYearNMonth) {
        if (SearchYearNMonth == InputYearNMonth) {
            return
        }
        SearchYearNMonth = InputYearNMonth;
        show_rank(SearchYearNMonth);

    }

    ////////////스와핑
    // var swiperWrapper = document.querySelector('.swiper-wrapper');
    var swiperWrapper = $('.swiper-wrapper');
    var iWebsite = "https://rafaelalucas.com/dailyui/6/assets/link.svg";
    /* Function to populate the team members */
    function addTeam() {
        swiperWrapper.empty();
        for (let i = 0; i < team.length; i++) {

            /* Variables for the team */
            // arr.push({name:Data[i]['user_name'],id:Data[i]['user_id'],role:Data[i]['post_cnt'],photo:"",website:Data[i]['user_url']})
            var rank = team[i].rank,
                name = team[i].name,
                id = team[i].id,
                post_cnt = team[i].post_cnt,
                photo = team[i].photo,
                website = team[i].website;


            /* Template for the Team Cards */
            var template = `
                <div class="swiper-slide" style="width: 280px; margin-right: 40px;">
                <div class="card">
                    <span class="bg"></span>
<!--                    <span class="more"></span>-->
                    <figure class="photo"><img src="${photo}"></figure>
                        <article class="text">
                            <p style="margin-top:10px;"></p>
                            <p class="name">${rank} 위</p>
                            <p class="name">${name}</p>
                            <p class="role">${id}</p>
                            <p class="role">${post_cnt}개 작성</p>

                        </article>

                        <div class="social">
<!--                        <span class="pointer"></span>-->
                        <div class="icons">
                            <a class="icon" href="${website}" target="_blank" data-index="0"><img src="${iWebsite}"></a>

                            </div>
                            </div>
                    </div>
                </div>`;

            // swiperWrapper.insertAdjacentHTML('beforeend', template);
            swiperWrapper.append(template);
        }
    };


</script>




<!-- The Modal -->
<div class="modal" id="fightingModal">
    <div class="modal-dialog">
      <div class="modal-content">
  
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">응원하기</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
  
        <!-- Modal body -->
        <div class="modal-body">
          응원의 메시지를 작성해주세요!
          <textarea class="form-control" rows="5" id="supportMessage"></textarea>
        </div>
  
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="submitSupport()">응원하기</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">닫기</button>
        </div>
  
      </div>
    </div>
  </div>

</body>

</html>
